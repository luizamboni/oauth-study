<svg xmlns="http://www.w3.org/2000/svg" width="960" height="420" viewBox="0 0 960 420">
  <rect width="960" height="420" fill="#ffffff"/>
  <style>
    .actor { fill: #f5f5f5; stroke: #333; stroke-width: 1.5; }
    .lifeline { stroke: #666; stroke-dasharray: 6 6; stroke-width: 1.2; }
    .arrow { stroke: #1a73e8; stroke-width: 2; marker-end: url(#arrowhead); fill: none; }
    .arrow-return { stroke: #34a853; stroke-width: 2; marker-end: url(#arrowhead); fill: none; stroke-dasharray: 6 4; }
    .label { font-family: "Helvetica Neue", Arial, sans-serif; font-size: 14px; fill: #222; }
    .title { font-weight: bold; font-size: 16px; }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1a73e8"/>
    </marker>
  </defs>

  <text x="480" y="28" text-anchor="middle" class="title label">Authorization Code Flow with PKCE</text>

  <!-- Actors -->
  <rect class="actor" x="40" y="50" width="140" height="40" rx="6"/>
  <text class="label" x="110" y="76" text-anchor="middle">User</text>
  <rect class="actor" x="240" y="50" width="160" height="40" rx="6"/>
  <text class="label" x="320" y="76" text-anchor="middle">Browser</text>
  <rect class="actor" x="470" y="50" width="220" height="40" rx="6"/>
  <text class="label" x="580" y="76" text-anchor="middle">OAuth Client (localhost:3000)</text>
  <rect class="actor" x="760" y="50" width="160" height="40" rx="6"/>
  <text class="label" x="840" y="76" text-anchor="middle">Keycloak</text>

  <!-- Lifelines -->
  <line class="lifeline" x1="110" y1="90" x2="110" y2="380"/>
  <line class="lifeline" x1="320" y1="90" x2="320" y2="380"/>
  <line class="lifeline" x1="580" y1="90" x2="580" y2="380"/>
  <line class="lifeline" x1="840" y1="90" x2="840" y2="380"/>

  <!-- Interactions -->
  <text class="label" x="170" y="130">1. Click "Start Authorization Code + PKCE flow"</text>
  <path class="arrow" d="M110 140 C140 140, 200 140, 280 140"/>

  <text class="label" x="450" y="180">2. GET /login</text>
  <path class="arrow" d="M320 190 C360 190, 420 190, 560 190"/>

  <text class="label" x="580" y="220">3. Generate code verifier/challenge + state</text>

  <text class="label" x="700" y="250">4. Redirect to auth endpoint</text>
  <path class="arrow" d="M580 260 C640 260, 720 260, 820 260"/>

  <text class="label" x="840" y="290">5. Prompt user for credentials</text>
  <path class="arrow" d="M840 300 C760 300, 680 300, 110 300"/>

  <text class="label" x="700" y="330">6. Authorization code redirected to /callback</text>
  <path class="arrow-return" d="M820 340 C720 340, 640 340, 580 340"/>

  <text class="label" x="700" y="370">7. Exchange code + PKCE verifier for tokens</text>
  <path class="arrow" d="M580 360 C640 360, 720 360, 820 360"/>
  <path class="arrow-return" d="M820 380 C720 380, 640 380, 580 380" stroke="#34a853"/>

  <text class="label" x="450" y="400">8. Render home with decoded tokens</text>
  <path class="arrow" d="M580 400 C420 400, 360 400, 320 400"/>
</svg>
